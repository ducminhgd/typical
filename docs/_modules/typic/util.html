
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>typic.util &#8212; typical 2.0.0b5 documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <link rel="canonical" href="https://seandstewart.github.io/typical/_modules/typic/util.html" />
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
    <link rel="apple-touch-icon" href="../../_static/favicon/apple-touch-icon.png" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../../index.html">
    <img class="logo" src="../../_static/logo.png" alt="Logo"/>
    
  </a>
</p>



<p class="blurb">A simple, fast, & correct data-validation library.</p>




<p>
<iframe src="https://ghbtns.com/github-btn.html?user=seandstewart&repo=typical&type=star&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





    

<p>
<a class="badge" href="https://travis-ci.org/seandstewart/typical">
    <img
        alt="https://secure.travis-ci.org/seandstewart/typical.svg?branch=master"
        src="https://secure.travis-ci.org/seandstewart/typical.svg?branch=master"
    />
</a>
</p>




    

<p>
<a class="badge" href="https://codecov.io/github/seandstewart/typical">
    <img
    alt="https://codecov.io/github/seandstewart/typical/coverage.svg?branch=master"
    src="https://codecov.io/github/seandstewart/typical/coverage.svg?branch=master"
    />
</a>
</p>
<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../why.html">Why <code class="docutils literal notranslate"><span class="pre">typical</span></code>?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../overview.html"><code class="docutils literal notranslate"><span class="pre">typical</span></code> Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usage/index.html"><code class="docutils literal notranslate"><span class="pre">typical</span></code> Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../extras/index.html"><code class="docutils literal notranslate"><span class="pre">typical</span></code> Extras</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/index.html">Low-Level API</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
              <div class="related top">
                &nbsp;
  <nav id="rellinks">
    <ul>
    </ul>
  </nav>
              </div>
          

          <div class="body" role="main">
            
  <h1>Source code for typic.util</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># -*- coding: UTF-8 -*-</span>
<span class="kn">import</span> <span class="nn">ast</span>
<span class="kn">import</span> <span class="nn">collections</span>
<span class="kn">import</span> <span class="nn">dataclasses</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">decimal</span>
<span class="kn">import</span> <span class="nn">functools</span>
<span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">import</span> <span class="nn">ipaddress</span>
<span class="kn">import</span> <span class="nn">pathlib</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">uuid</span>
<span class="kn">from</span> <span class="nn">collections.abc</span> <span class="k">import</span> <span class="n">Mapping</span> <span class="k">as</span> <span class="n">Mapping_abc</span><span class="p">,</span> <span class="n">Collection</span> <span class="k">as</span> <span class="n">Collection_abc</span>
<span class="kn">from</span> <span class="nn">threading</span> <span class="k">import</span> <span class="n">RLock</span>
<span class="kn">from</span> <span class="nn">types</span> <span class="k">import</span> <span class="n">MappingProxyType</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="k">import</span> <span class="p">(</span>
    <span class="n">Tuple</span><span class="p">,</span>
    <span class="n">Any</span><span class="p">,</span>
    <span class="n">Sequence</span><span class="p">,</span>
    <span class="n">Collection</span><span class="p">,</span>
    <span class="n">Mapping</span><span class="p">,</span>
    <span class="n">Hashable</span><span class="p">,</span>
    <span class="n">Type</span><span class="p">,</span>
    <span class="n">TypeVar</span><span class="p">,</span>
    <span class="n">Callable</span><span class="p">,</span>
    <span class="n">get_type_hints</span><span class="p">,</span>
    <span class="n">Union</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">import</span> <span class="nn">typic.checks</span> <span class="k">as</span> <span class="nn">checks</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">&quot;safe_eval&quot;</span><span class="p">,</span>
    <span class="s2">&quot;origin&quot;</span><span class="p">,</span>
    <span class="s2">&quot;get_args&quot;</span><span class="p">,</span>
    <span class="s2">&quot;resolve_supertype&quot;</span><span class="p">,</span>
    <span class="s2">&quot;cached_property&quot;</span><span class="p">,</span>
    <span class="s2">&quot;cached_signature&quot;</span><span class="p">,</span>
    <span class="s2">&quot;cached_type_hints&quot;</span><span class="p">,</span>
    <span class="s2">&quot;typed_dict_signature&quot;</span><span class="p">,</span>
    <span class="s2">&quot;filtered_repr&quot;</span><span class="p">,</span>
    <span class="s2">&quot;primitive&quot;</span><span class="p">,</span>
    <span class="s2">&quot;cachedmethod&quot;</span><span class="p">,</span>
    <span class="s2">&quot;fastcachedmethod&quot;</span><span class="p">,</span>
<span class="p">)</span>


<span class="k">def</span> <span class="nf">_get_loader</span><span class="p">():</span>  <span class="c1"># pragma: nocover</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">ujson</span>

        <span class="k">return</span> <span class="n">ujson</span><span class="o">.</span><span class="n">loads</span>

    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>  <span class="c1"># pragma: nocover</span>
        <span class="kn">import</span> <span class="nn">json</span>

        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span>


<span class="n">load</span> <span class="o">=</span> <span class="n">_get_loader</span><span class="p">()</span>

<span class="n">GENERIC_TYPE_MAP</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Sequence</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
    <span class="n">Sequence</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
    <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Collection</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
    <span class="n">Collection</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
    <span class="n">Mapping</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Mapping</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">Hashable</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Hashable</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<span class="p">}</span>


<div class="viewcode-block" id="safe_eval"><a class="viewcode-back" href="../../extras/utilities.html#typic.api.safe_eval">[docs]</a><span class="nd">@functools</span><span class="o">.</span><span class="n">lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> <span class="n">typed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">safe_eval</span><span class="p">(</span><span class="n">string</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;Try a few methods to evaluate a string and get the correct Python data-type.</span>

<span class="sd">    Return the result and an indicator for whether we could do anything with it.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; safe_eval(&#39;{&quot;foo&quot;: null}&#39;)</span>
<span class="sd">    (True, {&#39;foo&#39;: None})</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    string</span>
<span class="sd">        The string to attempt to evaluate into a valid Python data-structure or object</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    processed :</span>
<span class="sd">        Whether we successfully evaluated the string</span>
<span class="sd">    result :</span>
<span class="sd">        The final result of the operation</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">result</span><span class="p">,</span> <span class="n">processed</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="n">string</span><span class="p">),</span> <span class="kc">True</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">,</span> <span class="ne">SyntaxError</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span><span class="p">,</span> <span class="n">processed</span> <span class="o">=</span> <span class="n">load</span><span class="p">(</span><span class="n">string</span><span class="p">),</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">,</span> <span class="ne">SyntaxError</span><span class="p">):</span>
            <span class="n">result</span><span class="p">,</span> <span class="n">processed</span> <span class="o">=</span> <span class="n">string</span><span class="p">,</span> <span class="kc">False</span>

    <span class="k">return</span> <span class="n">processed</span><span class="p">,</span> <span class="n">result</span></div>


<span class="k">def</span> <span class="nf">_check_generics</span><span class="p">(</span><span class="n">hint</span><span class="p">:</span> <span class="n">Any</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">GENERIC_TYPE_MAP</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">hint</span><span class="p">,</span> <span class="n">hint</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">filtered_repr</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">dataclasses</span><span class="o">.</span><span class="n">fields</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">val</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">val</span> <span class="ow">or</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">{</span><span class="kc">False</span><span class="p">,</span> <span class="mi">0</span><span class="p">})</span> <span class="ow">and</span> <span class="n">f</span><span class="o">.</span><span class="n">repr</span><span class="p">:</span>
            <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;</span><span class="si">{f.name}</span><span class="s2">=</span><span class="si">{val!r}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">f</span><span class="s2">&quot;{type(self).__name__}({&#39;, &#39;.join(fields)})&quot;</span>


<div class="viewcode-block" id="origin"><a class="viewcode-back" href="../../extras/utilities.html#typic.api.origin">[docs]</a><span class="nd">@functools</span><span class="o">.</span><span class="n">lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">origin</span><span class="p">(</span><span class="n">annotation</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Get the &#39;origin&#39;-type for subclasses of typing._SpecialForm, recursive.</span>

<span class="sd">    For the purposes of this library, if we can resolve to a builtin type, we will.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; import typic</span>
<span class="sd">    &gt;&gt;&gt; from typing import Dict, Mapping, NewType, Optional</span>
<span class="sd">    &gt;&gt;&gt; typic.origin(Dict)</span>
<span class="sd">    &lt;class &#39;dict&#39;&gt;</span>
<span class="sd">    &gt;&gt;&gt; typic.origin(Mapping)</span>
<span class="sd">    &lt;class &#39;dict&#39;&gt;</span>
<span class="sd">    &gt;&gt;&gt; Registry = NewType(&#39;Registry&#39;, Dict)</span>
<span class="sd">    &gt;&gt;&gt; typic.origin(Registry)</span>
<span class="sd">    &lt;class &#39;dict&#39;&gt;</span>
<span class="sd">    &gt;&gt;&gt; typic.origin(Optional[Dict])</span>
<span class="sd">    &lt;class &#39;dict&#39;&gt;</span>
<span class="sd">    &gt;&gt;&gt; class Foo: ...</span>
<span class="sd">    ...</span>
<span class="sd">    &gt;&gt;&gt; typic.origin(Foo)</span>
<span class="sd">    &lt;class &#39;typic.util.Foo&#39;&gt;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Resolve custom NewTypes, recursively.</span>
    <span class="n">actual</span> <span class="o">=</span> <span class="n">resolve_supertype</span><span class="p">(</span><span class="n">annotation</span><span class="p">)</span>
    <span class="c1"># Extract the origin of the annotation, recursively.</span>
    <span class="n">actual</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">actual</span><span class="p">,</span> <span class="s2">&quot;__origin__&quot;</span><span class="p">,</span> <span class="n">actual</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">actual</span><span class="p">,</span> <span class="s2">&quot;__origin__&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">origin</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">checks</span><span class="o">.</span><span class="n">isoptionaltype</span><span class="p">(</span><span class="n">annotation</span><span class="p">)</span> <span class="ow">or</span> <span class="n">checks</span><span class="o">.</span><span class="n">isclassvartype</span><span class="p">(</span><span class="n">annotation</span><span class="p">):</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">get_args</span><span class="p">(</span><span class="n">annotation</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">origin</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">if</span> <span class="n">args</span> <span class="k">else</span> <span class="n">actual</span>

    <span class="c1"># provide defaults for generics</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">checks</span><span class="o">.</span><span class="n">isbuiltintype</span><span class="p">(</span><span class="n">actual</span><span class="p">):</span>
        <span class="n">actual</span> <span class="o">=</span> <span class="n">_check_generics</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">actual</span></div>


<div class="viewcode-block" id="get_args"><a class="viewcode-back" href="../../extras/utilities.html#typic.api.get_args">[docs]</a><span class="nd">@functools</span><span class="o">.</span><span class="n">lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">get_args</span><span class="p">(</span><span class="n">annotation</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;Get the args supplied to an annotation, excluding :py:class:`typing.TypeVar`.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; import typic</span>
<span class="sd">    &gt;&gt;&gt; from typing import Dict, TypeVar</span>
<span class="sd">    &gt;&gt;&gt; T = TypeVar(&quot;T&quot;)</span>
<span class="sd">    &gt;&gt;&gt; typic.get_args(Dict)</span>
<span class="sd">    ()</span>
<span class="sd">    &gt;&gt;&gt; typic.get_args(Dict[str, int])</span>
<span class="sd">    (&lt;class &#39;str&#39;&gt;, &lt;class &#39;int&#39;&gt;)</span>
<span class="sd">    &gt;&gt;&gt; typic.get_args(Dict[str, T])</span>
<span class="sd">    (&lt;class &#39;str&#39;&gt;,)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="o">*</span><span class="p">(</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">annotation</span><span class="p">,</span> <span class="s2">&quot;__args__&quot;</span><span class="p">,</span> <span class="p">())</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">TypeVar</span><span class="p">),</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="resolve_supertype"><a class="viewcode-back" href="../../extras/utilities.html#typic.api.resolve_supertype">[docs]</a><span class="nd">@functools</span><span class="o">.</span><span class="n">lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">resolve_supertype</span><span class="p">(</span><span class="n">annotation</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Resolve NewTypes, recursively.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; import typic</span>
<span class="sd">    &gt;&gt;&gt; from typing import NewType</span>
<span class="sd">    &gt;&gt;&gt; UserID = NewType(&quot;UserID&quot;, int)</span>
<span class="sd">    &gt;&gt;&gt; AdminID = NewType(&quot;AdminID&quot;, UserID)</span>
<span class="sd">    &gt;&gt;&gt; typic.resolve_supertype(AdminID)</span>
<span class="sd">    &lt;class &#39;int&#39;&gt;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">annotation</span><span class="p">,</span> <span class="s2">&quot;__supertype__&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">resolve_supertype</span><span class="p">(</span><span class="n">annotation</span><span class="o">.</span><span class="n">__supertype__</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">annotation</span></div>


<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">functools</span> <span class="k">import</span> <span class="n">cached_property</span>  <span class="c1"># type: ignore</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>

    <span class="c1"># The exact implementation in python 3.8 stdlib.</span>
    <span class="c1"># pragma: nocover</span>
    <span class="k">class</span> <span class="nc">cached_property</span><span class="p">:</span>  <span class="c1"># type: ignore</span>
        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">func</span> <span class="o">=</span> <span class="n">func</span>
            <span class="bp">self</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="vm">__doc__</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lock</span> <span class="o">=</span> <span class="n">RLock</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">__get__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">instance</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span>
            <span class="n">attrname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="o">.</span><span class="vm">__name__</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">cache</span> <span class="o">=</span> <span class="n">instance</span><span class="o">.</span><span class="vm">__dict__</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>  <span class="c1"># objects with __slots__ have no __dict__</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="n">f</span><span class="s2">&quot;No &#39;__dict__&#39; attribute on {type(instance).__name__!r} instance to cache </span><span class="si">{attrname!r}</span><span class="s2"> property.&quot;</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">None</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
                <span class="c1"># check if another thread filled cache while we awaited lock</span>
                <span class="k">if</span> <span class="n">attrname</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cache</span><span class="p">:</span>
                    <span class="n">cache</span><span class="p">[</span><span class="n">attrname</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">cache</span><span class="p">[</span><span class="n">attrname</span><span class="p">]</span>


<span class="c1"># stolen from functools._HashedSeq</span>
<span class="k">class</span> <span class="nc">__HashedSeq</span><span class="p">(</span><span class="nb">list</span><span class="p">):</span>

    <span class="vm">__slots__</span> <span class="o">=</span> <span class="s2">&quot;hashvalue&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tup</span><span class="p">,</span> <span class="nb">hash</span><span class="o">=</span><span class="nb">hash</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">tup</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hashvalue</span> <span class="o">=</span> <span class="nb">hash</span><span class="p">(</span><span class="n">tup</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">hashvalue</span>


<span class="c1"># Stolen approximately from functools._make_key</span>
<span class="c1"># Should try to find a faster way to do this.</span>
<span class="k">def</span> <span class="nf">_make_key</span><span class="p">(</span>
    <span class="n">args</span><span class="p">,</span>
    <span class="n">kwds</span><span class="p">,</span>
    <span class="n">kwd_mark</span><span class="o">=</span><span class="p">(</span><span class="nb">object</span><span class="p">(),),</span>
    <span class="n">fasttypes</span><span class="o">=</span><span class="nb">frozenset</span><span class="p">({</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">}),</span>
    <span class="nb">type</span><span class="o">=</span><span class="nb">type</span><span class="p">,</span>
    <span class="nb">len</span><span class="o">=</span><span class="nb">len</span><span class="p">,</span>
<span class="p">):</span>
    <span class="n">key</span> <span class="o">=</span> <span class="n">args</span>
    <span class="k">if</span> <span class="n">kwds</span><span class="p">:</span>
        <span class="n">key</span> <span class="o">+=</span> <span class="n">kwd_mark</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">kwds</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">key</span> <span class="o">+=</span> <span class="n">item</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">in</span> <span class="n">fasttypes</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">__HashedSeq</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>


<div class="viewcode-block" id="cachedmethod"><a class="viewcode-back" href="../../extras/utilities.html#typic.api.cachedmethod">[docs]</a><span class="k">def</span> <span class="nf">cachedmethod</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Thread-safe caching of the result of an instance method.</span>

<span class="sd">    Mimics some of the pure-Python implementation of :py:func:`functools.lru_cache`.</span>
<span class="sd">    Major differences are that it&#39;s un-bounded in size and no direct access to the cache.</span>
<span class="sd">    It&#39;s also slower, being that it&#39;s pure-Python and the actual ``_lru_cache_wrapper``</span>
<span class="sd">    is implemented in C.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">cache</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="vm">__dict__</span>
    <span class="n">cacheget</span> <span class="o">=</span> <span class="n">cache</span><span class="o">.</span><span class="n">get</span>
    <span class="n">makekey</span> <span class="o">=</span> <span class="n">_make_key</span>
    <span class="n">sentinel</span> <span class="o">=</span> <span class="nb">object</span><span class="p">()</span>
    <span class="n">lock</span> <span class="o">=</span> <span class="n">RLock</span><span class="p">()</span>

    <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_cached_method_wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">nonlocal</span> <span class="n">cache</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">makekey</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">kwargs</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">cacheget</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">sentinel</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">sentinel</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">result</span>
        <span class="k">with</span> <span class="n">lock</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">cache</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">return</span> <span class="n">_cached_method_wrapper</span></div>


<div class="viewcode-block" id="fastcachedmethod"><a class="viewcode-back" href="../../extras/utilities.html#typic.api.fastcachedmethod">[docs]</a><span class="k">def</span> <span class="nf">fastcachedmethod</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Super-fast memoization of a method.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    This is limited to a method that takes only one arg and is un-bounded in size.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; import typic</span>
<span class="sd">    &gt;&gt;&gt;</span>
<span class="sd">    &gt;&gt;&gt; class Foo:</span>
<span class="sd">    ...     @typic.fastcachedmethod</span>
<span class="sd">    ...     def bar(self, num: int) -&gt; int:</span>
<span class="sd">    ...         return num * (num + 1)</span>
<span class="sd">    ...</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">class</span> <span class="nc">memodict</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
        <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">()</span>

        <span class="k">def</span> <span class="nf">__missing__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">ret</span>

    <span class="n">sentinel</span> <span class="o">=</span> <span class="nb">object</span><span class="p">()</span>
    <span class="n">memo</span> <span class="o">=</span> <span class="n">memodict</span><span class="p">()</span>
    <span class="n">memoget</span> <span class="o">=</span> <span class="n">memo</span><span class="o">.</span><span class="fm">__getitem__</span>
    <span class="n">instance</span> <span class="o">=</span> <span class="n">sentinel</span>

    <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_fast_cached_method_wrapper</span><span class="p">(</span><span class="n">inst</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="k">nonlocal</span> <span class="n">instance</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="n">inst</span>
        <span class="k">return</span> <span class="n">memoget</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>

    <span class="n">_fast_cached_method_wrapper</span><span class="o">.</span><span class="n">cache_clear</span> <span class="o">=</span> <span class="n">memo</span><span class="o">.</span><span class="n">clear</span>

    <span class="k">return</span> <span class="n">_fast_cached_method_wrapper</span></div>


<div class="viewcode-block" id="cached_signature"><a class="viewcode-back" href="../../extras/utilities.html#typic.api.cached_signature">[docs]</a><span class="nd">@functools</span><span class="o">.</span><span class="n">lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">cached_signature</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">Callable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">inspect</span><span class="o">.</span><span class="n">Signature</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;A cached result of :py:func:`inspect.signature`.</span>

<span class="sd">    Building the function signature is notoriously slow, but we can be safe that the</span>
<span class="sd">    signature won&#39;t change at runtime, so we cache the result.</span>

<span class="sd">    We also provide a little magic so that we can introspect the new :py:class:`TypedDict`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="n">typed_dict_signature</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="k">if</span> <span class="n">checks</span><span class="o">.</span><span class="n">istypeddict</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="k">else</span> <span class="n">inspect</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="cached_type_hints"><a class="viewcode-back" href="../../extras/utilities.html#typic.api.cached_type_hints">[docs]</a><span class="nd">@functools</span><span class="o">.</span><span class="n">lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">cached_type_hints</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">Callable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;A cached result of :py:func:`typing.get_type_hints`.</span>

<span class="sd">    We don&#39;t want to go through the process of resolving type-hints every time.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">get_type_hints</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span></div>


<div class="viewcode-block" id="typed_dict_signature"><a class="viewcode-back" href="../../extras/utilities.html#typic.api.typed_dict_signature">[docs]</a><span class="k">def</span> <span class="nf">typed_dict_signature</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">Callable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">inspect</span><span class="o">.</span><span class="n">Signature</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;A little faker for getting the &quot;signature&quot; of a :py:class:`TypedDict`.</span>

<span class="sd">    Technically, these are dicts at runtime, but we are enforcing a static shape,</span>
<span class="sd">    so we should be able to declare a matching signature for it.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">hints</span> <span class="o">=</span> <span class="n">cached_type_hints</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">inspect</span><span class="o">.</span><span class="n">Signature</span><span class="p">(</span>
        <span class="n">parameters</span><span class="o">=</span><span class="nb">tuple</span><span class="p">(</span>
            <span class="n">inspect</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
                <span class="n">kind</span><span class="o">=</span><span class="n">inspect</span><span class="o">.</span><span class="n">Parameter</span><span class="o">.</span><span class="n">KEYWORD_ONLY</span><span class="p">,</span>
                <span class="n">annotation</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
                <span class="n">default</span><span class="o">=</span><span class="kc">None</span> <span class="k">if</span> <span class="n">checks</span><span class="o">.</span><span class="n">isoptionaltype</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="k">else</span> <span class="n">inspect</span><span class="o">.</span><span class="n">Parameter</span><span class="o">.</span><span class="n">empty</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">hints</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">)</span>
    <span class="p">)</span></div>


<span class="n">DEFAULT_ENCODING</span> <span class="o">=</span> <span class="s2">&quot;utf-8&quot;</span>


<div class="viewcode-block" id="primitive"><a class="viewcode-back" href="../../usage/advanced.html#typic.api.primitive">[docs]</a><span class="nd">@functools</span><span class="o">.</span><span class="n">singledispatch</span>
<span class="k">def</span> <span class="nf">primitive</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;A single-dispatch function for converting an object to its primitive equivalent.</span>

<span class="sd">    Useful for encoding data to JSON.</span>

<span class="sd">    Registration for custom types may be done by wrapping your handler with `@primitive.register`</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; import typic</span>
<span class="sd">    &gt;&gt;&gt; import datetime</span>
<span class="sd">    &gt;&gt;&gt; import uuid</span>
<span class="sd">    &gt;&gt;&gt; import ipaddress</span>
<span class="sd">    &gt;&gt;&gt; import re</span>
<span class="sd">    &gt;&gt;&gt; import dataclasses</span>
<span class="sd">    &gt;&gt;&gt; typic.primitive(&quot;foo&quot;)</span>
<span class="sd">    &#39;foo&#39;</span>
<span class="sd">    &gt;&gt;&gt; typic.primitive((&quot;foo&quot;,))  # containers are converted to lists/dicts</span>
<span class="sd">    [&#39;foo&#39;]</span>
<span class="sd">    &gt;&gt;&gt; typic.primitive(datetime.datetime(1970, 1, 1))  # note that we assume UTC</span>
<span class="sd">    &#39;1970-01-01T00:00:00+00:00&#39;</span>
<span class="sd">    &gt;&gt;&gt; typic.primitive(b&quot;foo&quot;)</span>
<span class="sd">    &#39;foo&#39;</span>
<span class="sd">    &gt;&gt;&gt; typic.primitive(ipaddress.IPv4Address(&quot;0.0.0.0&quot;))</span>
<span class="sd">    &#39;0.0.0.0&#39;</span>
<span class="sd">    &gt;&gt;&gt; typic.primitive(re.compile(&quot;[0-9]&quot;))</span>
<span class="sd">    &#39;[0-9]&#39;</span>
<span class="sd">    &gt;&gt;&gt; typic.primitive(uuid.UUID(int=0))</span>
<span class="sd">    &#39;00000000-0000-0000-0000-000000000000&#39;</span>
<span class="sd">    &gt;&gt;&gt; @dataclasses.dataclass</span>
<span class="sd">    ... class Foo:</span>
<span class="sd">    ...     bar: str = &#39;bar&#39;</span>
<span class="sd">    ...</span>
<span class="sd">    &gt;&gt;&gt; typic.primitive(Foo())</span>
<span class="sd">    {&#39;bar&#39;: &#39;bar&#39;}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Common methods found in classes for dumping to dicts</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s2">&quot;asdict&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">primitive</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">asdict</span><span class="p">())</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s2">&quot;to_dict&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">primitive</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">to_dict</span><span class="p">())</span>
    <span class="c1"># Dataclasses, duh.</span>
    <span class="k">if</span> <span class="n">dataclasses</span><span class="o">.</span><span class="n">is_dataclass</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">primitive</span><span class="p">(</span><span class="n">dataclasses</span><span class="o">.</span><span class="n">asdict</span><span class="p">(</span><span class="n">obj</span><span class="p">))</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Can&#39;t determine primitive from type {type(obj)!r}&quot;</span><span class="p">)</span></div>


<span class="n">IPvAnyType</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span>
    <span class="n">ipaddress</span><span class="o">.</span><span class="n">IPv4Address</span><span class="p">,</span>
    <span class="n">ipaddress</span><span class="o">.</span><span class="n">IPv6Interface</span><span class="p">,</span>
    <span class="n">ipaddress</span><span class="o">.</span><span class="n">IPv4Network</span><span class="p">,</span>
    <span class="n">ipaddress</span><span class="o">.</span><span class="n">IPv6Address</span><span class="p">,</span>
    <span class="n">ipaddress</span><span class="o">.</span><span class="n">IPv6Interface</span><span class="p">,</span>
    <span class="n">ipaddress</span><span class="o">.</span><span class="n">IPv6Network</span><span class="p">,</span>
<span class="p">]</span>


<span class="nd">@primitive</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
<span class="nd">@primitive</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="nd">@primitive</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
<span class="nd">@primitive</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="nd">@primitive</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">))</span>
<span class="k">def</span> <span class="nf">_</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">obj</span>


<span class="nd">@primitive</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
<span class="nd">@primitive</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">Mapping_abc</span><span class="p">)</span>
<span class="nd">@primitive</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">MappingProxyType</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">_</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">{</span><span class="n">primitive</span><span class="p">(</span><span class="n">x</span><span class="p">):</span> <span class="n">primitive</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>


<span class="nd">@primitive</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
<span class="nd">@primitive</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="nb">tuple</span><span class="p">)</span>
<span class="nd">@primitive</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="nb">set</span><span class="p">)</span>
<span class="nd">@primitive</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="nb">frozenset</span><span class="p">)</span>
<span class="nd">@primitive</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">Collection_abc</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">_</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">primitive</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">]</span>


<span class="nd">@primitive</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="nb">bytes</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
<span class="nd">@primitive</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="nb">bytearray</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">_</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">DEFAULT_ENCODING</span><span class="p">)</span>


<span class="nd">@primitive</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">ipaddress</span><span class="o">.</span><span class="n">IPv4Address</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
<span class="nd">@primitive</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">ipaddress</span><span class="o">.</span><span class="n">IPv4Interface</span><span class="p">)</span>
<span class="nd">@primitive</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">ipaddress</span><span class="o">.</span><span class="n">IPv4Network</span><span class="p">)</span>
<span class="nd">@primitive</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">ipaddress</span><span class="o">.</span><span class="n">IPv6Address</span><span class="p">)</span>
<span class="nd">@primitive</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">ipaddress</span><span class="o">.</span><span class="n">IPv6Interface</span><span class="p">)</span>
<span class="nd">@primitive</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">ipaddress</span><span class="o">.</span><span class="n">IPv6Network</span><span class="p">)</span>
<span class="nd">@primitive</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">)</span>
<span class="nd">@primitive</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">UUID</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">_</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">IPvAnyType</span><span class="p">,</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span> <span class="n">uuid</span><span class="o">.</span><span class="n">UUID</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>


<span class="nd">@primitive</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
<span class="nd">@primitive</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">)</span>
<span class="nd">@primitive</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">_</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">time</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">time</span><span class="p">))</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">obj</span><span class="o">.</span><span class="n">tzinfo</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">f</span><span class="s2">&quot;{obj.isoformat()}+00:00&quot;</span>
    <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>


<span class="nd">@primitive</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">Pattern</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
<span class="k">def</span> <span class="nf">_</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">Pattern</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>  <span class="c1"># type: ignore</span>
    <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">pattern</span>


<span class="nd">@primitive</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
<span class="k">def</span> <span class="nf">_</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
</pre></div>

          </div>
              <div class="related bottom">
                &nbsp;
  <nav id="rellinks">
    <ul>
    </ul>
  </nav>
              </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy;Copyright 2019 Sean Stewart.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.2.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>